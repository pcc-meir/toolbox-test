{"version":3,"file":"JwtDecoder.esm.js","sources":["../../../src/components/Encoders/JwtDecoder.tsx"],"sourcesContent":["import React, { useCallback, useEffect } from 'react';\nimport jwtDecode, { JwtPayload } from 'jwt-decode';\nimport { DefaultEditor } from '../DefaultEditor';\nimport { SignJWT } from 'jose';\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { useToolboxTranslation } from '../../hooks';\n\nconst BASE64_REGEX =\n  /^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/;\n\nexport const JwtDecoder = () => {\n  const alertApi = useApi(alertApiRef);\n  const [input, setInput] = React.useState('');\n  const [output, setOutput] = React.useState('');\n  const [mode, setMode] = React.useState('Encode');\n  const { t } = useToolboxTranslation();\n\n  const exampleJwt =\n    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyLCJleHAiOjE1MTYyMzkwMjJ9.4Adcj3UFYzPUVaVF43FmMab6RlaQD8A9V8wFzzht-KQ';\n  const exampleJSON = {\n    header: {\n      alg: 'HS256',\n      typ: 'JWT',\n    },\n    payload: {\n      sub: 1234567890,\n      iat: 1516239022,\n      iss: 'John Doe',\n      exp: 1516239022,\n    },\n    key: 'exampleSecretKey',\n  };\n\n  const showError = useCallback(\n    attribute => {\n      const errorMessage = t(`tool.jwt-decoder-encode.missingAttribute`, {\n        attribute,\n      });\n      setOutput(errorMessage);\n      alertApi.post({\n        message: errorMessage,\n        severity: 'error',\n        display: 'transient',\n      });\n      return false;\n    },\n    [t, alertApi],\n  );\n\n  const keyExists = useCallback(\n    json => {\n      if (!('key' in json)) {\n        return showError('key');\n      }\n      return true;\n    },\n    [showError],\n  );\n\n  const payloadExists = useCallback(\n    json => {\n      if (!('payload' in json)) {\n        return showError('payload');\n      }\n      if (!('iat' in json.payload)) {\n        return showError('payload.iat');\n      }\n      if (!('iss' in json.payload)) {\n        return showError('payload.iss');\n      }\n      if (!('exp' in json.payload)) {\n        return showError('payload.exp');\n      }\n      return true;\n    },\n    [showError],\n  );\n\n  const headerExists = useCallback(\n    json => {\n      if (!('header' in json)) {\n        return showError('header');\n      }\n      if (!('alg' in json.header)) {\n        return showError('header.alg');\n      }\n      return true;\n    },\n    [showError],\n  );\n\n  useEffect(() => {\n    if (mode === 'Decode') {\n      let value = input;\n      if (BASE64_REGEX.test(value)) {\n        value = atob(value);\n      }\n\n      try {\n        const jwtPayload = jwtDecode<JwtPayload>(value);\n        setOutput(`Issued date:\n${jwtPayload.iat && new Date(jwtPayload.iat * 1000)}\n\nExpiration date:\n${jwtPayload.exp && new Date(jwtPayload.exp * 1000)}\n\nHeader:\n${JSON.stringify(jwtDecode(input, { header: true }), null, 2)}\n\nPayload:\n${JSON.stringify(jwtPayload, null, 2)}`);\n      } catch (error) {\n        setOutput(t('tool.jwt-decoder-encode.decodeError', { error }));\n      }\n    } else {\n      try {\n        const inputJSON = JSON.parse(input);\n        if (\n          keyExists(inputJSON) &&\n          payloadExists(inputJSON) &&\n          headerExists(inputJSON)\n        ) {\n          const secret = new TextEncoder().encode(inputJSON.key);\n          (async () => {\n            const token = await new SignJWT(inputJSON.payload)\n              .setProtectedHeader(inputJSON.header)\n              .setIssuedAt(inputJSON.payload.iat)\n              .setIssuer(inputJSON.payload.iss)\n              .setExpirationTime(inputJSON.payload.exp)\n              .sign(secret);\n            setOutput(token);\n          })();\n        }\n\n        if (!('header' in inputJSON)) {\n          const errorMessage = t(`tool.jwt-decoder-encode.missingAttribute`, {\n            attribute: 'header',\n          });\n          setOutput(errorMessage);\n        }\n      } catch (error) {\n        setOutput(t('tool.jwt-decoder-encode.encodeError', { error }));\n      }\n    }\n  }, [input, mode, headerExists, keyExists, payloadExists, t]);\n\n  return (\n    <DefaultEditor\n      input={input}\n      mode={mode}\n      setInput={setInput}\n      setMode={setMode}\n      modes={['Encode', 'Decode']}\n      sample={\n        mode === 'Encode' ? JSON.stringify(exampleJSON, null, 4) : exampleJwt\n      }\n      output={output}\n    />\n  );\n};\n\nexport default JwtDecoder;\n"],"names":[],"mappings":"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"}